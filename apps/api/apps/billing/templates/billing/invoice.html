<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <title>Facture {{ invoice.invoice_number }}</title>
    <style>
      body { font-family: sans-serif; font-size: 12px; }
      h1 { font-size: 18px; margin-bottom: 0; }
      .muted { color: #555; }
      .header, .footer { width: 100%; }
      .footer { position: fixed; bottom: 0; font-size: 10px; }
      table { width: 100%; border-collapse: collapse; margin-top: 16px; }
      th, td { border: 1px solid #ddd; padding: 6px; }
      th { background: #f4f4f4; }
      .right { text-align: right; }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Facture {{ invoice.invoice_number }}</h1>
      <div class="muted">{{ invoice.title }}</div>
      <div>Date: {{ invoice.invoice_date }} &nbsp; • &nbsp; Échéance: {{ invoice.due_date }}</div>
      <div>Client: {{ invoice.client.name }}</div>
      {% if invoice.project %}<div>Projet: {{ invoice.project.title }}</div>{% endif %}
    </div>

    <table>
      <thead>
        <tr>
          <th>Titre</th>
          <th>Description</th>
          <th class="right">Qté</th>
          <th class="right">PU (HT)</th>
          <th class="right">Total (HT)</th>
        </tr>
      </thead>
      <tbody>
        {% for item in invoice.items.all %}
        <tr>
          <td>{{ item.title }}</td>
          <td>{{ item.description }}</td>
          <td class="right">{{ item.quantity }}</td>
          <td class="right">{{ item.unit_price }}</td>
          <td class="right">{{ item.total_price }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <table>
      <tbody>
        <tr>
          <td class="right">Sous-total (HT)</td>
          <td class="right">{{ invoice.subtotal_ht }}</td>
        </tr>
        <tr>
          <td class="right">TVA ({{ invoice.tax_rate }}%)</td>
          <td class="right">{{ invoice.tax_amount }}</td>
        </tr>
        <tr>
          <td class="right"><strong>Total (TTC)</strong></td>
          <td class="right"><strong>{{ invoice.total_ttc }}</strong></td>
        </tr>
      </tbody>
    </table>

    {% if invoice.payment_terms %}
    <p class="muted">Conditions: {{ invoice.payment_terms }}</p>
    {% endif %}

    {% if invoice.notes %}
    <p>Notes: {{ invoice.notes }}</p>
    {% endif %}

    <div class="footer">
      NOURX — Généré le {{ invoice.pdf_generated_at|default:invoice.updated_at }}
    </div>
  </body>
  </html>

